<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="application-name" content="Llum Requena">
    <meta name="apple-mobile-web-app-title" content="Llum Requena">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#ff6b35">
    <title>Llum Requena - Gesti√≥n de Obras</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9InJheW9HcmFkaWVudCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNmZjhkNTYiLz4KPHN0b3Agb2Zmc2V0PSIzMCUiIHN0b3AtY29sb3I9IiNmZjZiMzUiLz4KPHN0b3Agb2Zmc2V0PSI3MCUiIHN0b3AtY29sb3I9IiNmZjQ1MDAiLz4KPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjZTU1MTAwIi8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPHBhdGggZD0iTTIwIDIwTDUwIDEwTDcwIDMwTDQ1IDQ1TDYwIDY1TDM1IDc1TDUwIDUwTDMwIDM1TDIwIDIwWiIgZmlsbD0idXJsKCNyYXlvR3JhZGllbnQpIiBzdHJva2U9IiNmZjQ1MDAiIHN0cm9rZS13aWR0aD0iMSIvPgo8L3N2Zz4=">
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9InJheW9HcmFkaWVudCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CjxzdG9wIG9mZnNldD0iMCUiIHN0b3AtY29sb3I9IiNmZjhkNTYiLz4KPHN0b3Agb2Zmc2V0PSIzMCUiIHN0b3AtY29sb3I9IiNmZjZiMzUiLz4KPHN0b3Agb2Zmc2V0PSI3MCUiIHN0b3AtY29sb3I9IiNmZjQ1MDAiLz4KPHN0b3Agb2Zmc2V0PSIxMDAlIiBzdG9wLWNvbG9yPSIjZTU1MTAwIi8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPHJlY3Qgd2lkdGg9IjEwMCIgaGVpZ2h0PSIxMDAiIGZpbGw9IiNmZmYiIHJ4PSIyMCIvPgo8cGF0aCBkPSJNMjAgMjBMNTAgMTBMNzAgMzBMNDUgNDVMNjAgNjVMMzUgNzVMNTAgNTBMMzAgMzVMMjAgMjBaIiBmaWxsPSJ1cmwoI3JheW9HcmFkaWVudCkiIHN0cm9rZT0iI2ZmNDUwMCIgc3Ryb2tlLXdpZHRoPSIxIi8+Cjwvc3ZnPg==">
    <link rel="manifest" href="data:application/manifest+json;base64,eyJuYW1lIjoiTGx1bSBSZXF1ZW5hIC0gR2VzdGnDs24gZGUgT2JyYXMiLCJzaG9ydF9uYW1lIjoiTGx1bSBSZXF1ZW5hIiwiZGVzY3JpcHRpb24iOiJBcGxpY2FjacOzbiBkZSBnZXN0acOzbiBkZSBvYnJhcyBlbMOpY3RyaWNhcyIsInN0YXJ0X3VybCI6Ii4vIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiI2ZmNmIzNSIsInRoZW1lX2NvbG9yIjoiI2ZmNmIzNSIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWw7YmFzZTY0LFBITjJaeUIzYVdSMGFEMGlOVEV5SWlCb1pXbG5hSFE5SWpVeE1pSWlJSFpwWlhkQ2IzZzlJakFnTUNBMU1USWdOVEV5SWlCbWFXeHNQU0p1YjI1bElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaVBnbzhaR1ZtY3o0S1BHeHBibVZoY2tkeVlXUnBaVzUwSUdsa1BTSnlZWGx2UjNKaFpHbGxiblFpSUhnek1UMGlNQ1VpSUhreFBTSXdKU0lpSUhnek1qMGlNVEF3SlNJZ2VUSXhJakV3TUNVaVBnbzljM1J2Y0NCdlptWnpaWFE5SWpBbElpQnpkRzl3TFdOdmJHOXlQU0lpSTJabU9HUTFOaUl2UGdvOWMzUnZjQ0J2Wm1aelpYUTlTakl3SlNJZ2MzUnZjQzFqYjJ4dmNqMGlJMlptTmpKek5TVXZQZ285YzNSdmNDQnZabVp6WlhROUlqY3dKU0lpSUhOMGIzQXRZMjlzYjNJOUlpTm1aalkwTlRBd0lpOCtQQzl6ZEc5d0lHOW1abk5sZEQwaU1UQXdKU0lpSUhOMGIzQXRZMjlzYjNJOUlpTmxOVFV4TURBaUx6NEtQQzlzYVc1bFlYSkhjbUZrYVdWdWRENEtQQzlrWldaelBnbzhjbVZqZENCM2FXUjBhRDBpTlRFeUlpQm9aV2xuYUhROUlqVXhNaUlpSUdacGJHdzlTaVptWm1ZaUlISjRQU0l5TUNJdlBnbzhjR0YwYUNCa1BTSk5OakVnTmpKTU1UUXdJRE0xVERJNU1TQXlNVEZNTWpreElESTNNa3d6TmpFZ01qSTJUalE0T0RNaUlHWnBiR3c5U25WeWJDZ2pjbUY1YjBkeVlXUnBaVzUwS1NJZ2MzUnliMnRsUFNJalk0WTFOemd6WmlJZ2MzUnliMnRsTFhkcFpIUm9QU0l6SWk4K1BnbzhjR0YwYUNCa1BTSk5NalEySUROaVRESTJOQ0F5TVRWTWJqSjRSRUV4TmlJZ1ptbHNiRDBpSTJabU5qWXpOVjkpSWlCemRISnZhMlU5U2lObVpqUTFNREFpSUhOMGNtOXJaUzEzYVdSMGFEMGlNU0l2UGdvOEwzTjJaejQ4SWkwekluTjBjbTlyWlMxM2FXUjBhRDBpYXlJdlBnSjZaeUIzYVdSMGFEMGlOVEV5SWlCb1pXbG5hSFE5SWpVeE1pSWlJSFpwWlhkQ2IzZzlJakFnTUNBMU1USWdOVEV5SWlCbWFXeHNQU0p1YjI1bElpQjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaVBnbzhaR1ZtY3o0S1BHeHBibVZoY2tkeVlXUnBaVzUwSUdsa1BTSnlZWGx2UjNKaFpHbGxiblFpSUhnek1UMGlNQ1VpSUhreFBTSXdKU0lpSUhnek1qMGlNVEF3SlNJZ2VUSXhJakV3TUNVaVBnbzljM1J2Y0NCdlptWnpaWFE5SWpBbElpQnpkRzl3TFdOdmJHOXlQU0lpSTJabU9HUTFOaUlpTHo0S1BITjBiM0FnYjJabWMyVjBQU0l6TUNVaUlpQnpkRzl3TFdOdmJHOXlQU0lpSTJabU5tSXpOU0luUGdvOWMzUnZjQ0J2Wm1aelpYUTlJamN3SlNJZ2MzUnZjQzFqYjJ4dmNqMGlJMlptTmpRMU1EQWlMejRLUEhOMGIzQWdiMlptWm5ObGREMGlNVEF3SlNJZ2MzUnZjQzFqYjJ4dmNqMGlJMlUxTlRFd01DSXZQZ284TDJ4cGJtVmhja2R5WVdScFpXNTBQZ284TDJSbFpuTStDbU51T1Nob2QxbGtSMWdnV0hsblhGSFZBa2dOZHpjZ1EwRXRHUzVxWVdKeFZXSlhhQzVLTHowOUlpNU5rYUU0SUJBZ01qUk1OVEE0UXpJb09qUWdORmN6VElORnJERDVPTWpBeVRHeExPV2tnT2pTZ05qR01TekpDZGlOT1lRZ05qa2dPVFJ3UVdBK1JqVTVNVEZzTWpReVNWRXRORGNnWVNJZ1ptbHNiRDBpSjNWeWJDaGpjbUY1YjBkeVlXUnBaVzUwS1NJZ2MzUnliMnRsUFNJalptWTBOVEF3SWlCemRISnZhMlV0ZDJsa1ltTmhOZ29odGRCZzA8">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Lexend', sans-serif;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 50%, #ff8c42 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            margin-bottom: 10px;
        }

        .logo h1 {
            color: #ff4500;
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .logo-icon {
            font-size: 2.5em;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }

        .logo-icon:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .logo-icon svg {
            filter: drop-shadow(2px 2px 4px rgba(255, 69, 0, 0.3));
            transition: all 0.3s ease;
        }

        .logo-icon:hover svg {
            filter: drop-shadow(2px 2px 8px rgba(255, 69, 0, 0.5));
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
            font-weight: 400;
        }

        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .nav-tab {
            background: linear-gradient(45deg, #ff6b35, #ff4500);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Lexend', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.4);
            background: linear-gradient(45deg, #ff8c42, #ff6b35);
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #ff4500, #e55100);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 69, 0, 0.5);
        }

        .content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            min-height: 500px;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid #ff6b35;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e1e1;
            border-radius: 10px;
            font-family: 'Lexend', sans-serif;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .btn {
            background: linear-gradient(45deg, #ff6b35, #ff4500);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Lexend', sans-serif;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.2);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
            background: linear-gradient(45deg, #ff8c42, #ff6b35);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #95a5a6, #7f8c8d);
        }

        .btn-danger {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .grid {
            display: grid;
            gap: 20px;
            margin-top: 20px;
        }

        .grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #ff6b35, #ff4500);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.3);
        }

        .stat-number {
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .obra-item, .presupuesto-item, .factura-item, .gasto-item, .foto-item, .pdf-item {
            background: rgba(255, 255, 255, 0.9);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid #ff6b35;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .item-title {
            font-weight: 600;
            color: #333;
        }

        .item-amount {
            font-weight: 600;
            color: #ff4500;
            font-size: 1.1em;
        }

        .item-date {
            color: #666;
            font-size: 0.9em;
        }

        .gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .photo-preview {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .photo-preview:hover {
            transform: scale(1.05);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90%;
            max-height: 90%;
        }

        .modal img {
            max-width: 100%;
            max-height: 100%;
            border-radius: 10px;
        }

        .close {
            position: absolute;
            top: 10px;
            right: 20px;
            color: white;
            font-size: 30px;
            cursor: pointer;
        }

        .file-input-wrapper {
            position: relative;
            display: inline-block;
            cursor: pointer;
            background: linear-gradient(45deg, #ff6b35, #ff4500);
            color: white;
            padding: 12px 24px;
            border-radius: 10px;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            box-shadow: 0 4px 15px rgba(255, 107, 53, 0.2);
        }

        .file-input-wrapper:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 107, 53, 0.3);
            border-color: #ff8c42;
            background: linear-gradient(45deg, #ff8c42, #ff6b35);
        }

        .file-input-wrapper.error {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .file-input-wrapper input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
            z-index: 1;
        }

        .file-input-wrapper span {
            position: relative;
            z-index: 0;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header {
                padding: 15px;
            }

            .logo h1 {
                font-size: 2em;
            }

            .nav-tabs {
                gap: 5px;
            }

            .nav-tab {
                padding: 10px 16px;
                font-size: 0.9em;
            }

            .content {
                padding: 20px;
            }

            .stats {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
        }

        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-weight: 500;
        }

        .alert-info {
            background-color: #d1ecf1;
            border-left: 4px solid #bee5eb;
            color: #0c5460;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #ff6b35, #ff4500);
            border-radius: 10px;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <div class="logo-icon">
                    <svg width="40" height="40" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="rayoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" stop-color="#ff8d56"/>
                                <stop offset="30%" stop-color="#ff6b35"/>
                                <stop offset="70%" stop-color="#ff4500"/>
                                <stop offset="100%" stop-color="#e55100"/>
                            </linearGradient>
                        </defs>
                        <path d="M15 15L45 5L65 25L40 40L55 60L30 70L45 45L25 30L15 15Z" fill="url(#rayoGradient)" stroke="#ff4500" stroke-width="1"/>
                    </svg>
                </div>
                <h1>Llum Requena</h1>
            </div>
            <p class="subtitle">Gesti√≥n de Obras de Instalaciones El√©ctricas</p>
            
            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showSection('dashboard')">Dashboard</button>
                <button class="nav-tab" onclick="showSection('obras')">Obras</button>
                <button class="nav-tab" onclick="showSection('presupuestos')">Presupuestos</button>
                <button class="nav-tab" onclick="showSection('facturas')">Facturas</button>
                <button class="nav-tab" onclick="showSection('gastos')">Gastos</button>
                <button class="nav-tab" onclick="showSection('fotos')">Fotos</button>
                <button class="nav-tab" onclick="showSection('archivos')">Archivos PDF</button>
            </div>
        </div>

        <div class="content">
            <!-- Dashboard -->
            <div id="dashboard" class="section active">
                <h2 style="margin-bottom: 20px; color: #333;">Panel de Control</h2>
                
                <div class="alert alert-info">
                    <strong>‚úÖ Almacenamiento Persistente Activado:</strong> Los datos se guardan autom√°ticamente en tu dispositivo y permanecer√°n disponibles cuando vuelvas a abrir la aplicaci√≥n.
                    <br><br>
                    <strong>üß° Logo Corporativo:</strong> Dise√±o integrado con el rayo distintivo de Llum Requena. Al agregar a m√≥vil aparecer√° el icono oficial de tu empresa.
                    <br><br>
                    <strong>ü§ñ Chrome OS:</strong> Si tienes problemas con archivos, usa el bot√≥n "üõ†Ô∏è Soluciones Chrome OS" para ver m√©todos alternativos como CodePen.io o servidor local.
                    <br><br>
                    <strong>üîß Estado del Sistema:</strong>
                    <div id="systemStatus" style="margin-top: 10px; padding: 10px; background: rgba(255,255,255,0.5); border-radius: 5px;">
                        Verificando compatibilidad...
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #ff4500;">Gesti√≥n de Datos</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn" onclick="exportData()">üì• Exportar Datos</button>
                        <button class="btn btn-secondary" onclick="importData()">üì§ Importar Datos</button>
                        <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Limpiar Todos los Datos</button>
                    </div>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px;">
                        <button class="btn btn-secondary" onclick="testFileUpload()">üß™ Probar Subida de Archivos</button>
                        <button class="btn btn-secondary" onclick="testLocalStorage()">üíæ Probar Almacenamiento</button>
                        <button class="btn btn-secondary" onclick="forceFileDialog()">üìÅ Forzar Di√°logo de Archivos</button>
                        <button class="btn btn-secondary" onclick="showChromeOSSolutions()">üõ†Ô∏è Soluciones Chrome OS</button>
                        <button class="btn btn-secondary" onclick="copyCodeToClipboard()">üìã Copiar C√≥digo Completo</button>
                    </div>
                    <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(event)">
                    <input type="file" id="testFile" accept="*" style="display: none;" onchange="handleTestFile(event)">
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="stat-number" id="totalObras">0</div>
                        <div class="stat-label">Obras Activas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalPresupuesto">0‚Ç¨</div>
                        <div class="stat-label">Presupuesto Total</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalFacturado">0‚Ç¨</div>
                        <div class="stat-label">Total Facturado</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalGastos">0‚Ç¨</div>
                        <div class="stat-label">Gastos Material</div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #ff4500;">Resumen de Obras Recientes</h3>
                    <div id="obrasRecientes">
                        <p style="color: #666;">No hay obras registradas</p>
                    </div>
                </div>
            </div>

            <!-- Obras -->
            <div id="obras" class="section">
                <h2 style="margin-bottom: 20px; color: #333;">Gesti√≥n de Obras</h2>

                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #ff4500;">Nueva Obra</h3>
                    <form id="obraForm">
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label>Nombre de la Obra</label>
                                <input type="text" id="obraNombre" required>
                            </div>
                            <div class="form-group">
                                <label>Cliente</label>
                                <input type="text" id="obraCliente" required>
                            </div>
                            <div class="form-group">
                                <label>Fecha de Inicio</label>
                                <input type="date" id="obraFechaInicio" required>
                            </div>
                            <div class="form-group">
                                <label>Fecha Estimada de Finalizaci√≥n</label>
                                <input type="date" id="obraFechaFin">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <textarea id="obraDescripcion" placeholder="Descripci√≥n detallada de la obra..."></textarea>
                        </div>
                        <button type="submit" class="btn">Crear Obra</button>
                    </form>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #ff4500;">Obras Registradas</h3>
                    <div id="listaObras">
                        <p style="color: #666;">No hay obras registradas</p>
                    </div>
                </div>
            </div>

            <!-- Presupuestos -->
            <div id="presupuestos" class="section">
                <h2 style="margin-bottom: 20px; color: #333;">Presupuestos</h2>

                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #ff4500;">Nuevo Presupuesto</h3>
                    <form id="presupuestoForm">
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label>Obra</label>
                                <select id="presupuestoObra" required>
                                    <option value="">Seleccionar obra...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Concepto</label>
                                <input type="text" id="presupuestoConcepto" required>
                            </div>
                            <div class="form-group">
                                <label>Importe (‚Ç¨)</label>
                                <input type="number" step="0.01" id="presupuestoImporte" required>
                            </div>
                            <div class="form-group">
                                <label>Fecha</label>
                                <input type="date" id="presupuestoFecha" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <textarea id="presupuestoDescripcion" placeholder="Detalles del presupuesto..."></textarea>
                        </div>
                        <button type="submit" class="btn">Guardar Presupuesto</button>
                    </form>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #ff4500;">Presupuestos Registrados</h3>
                    <div id="listaPresupuestos">
                        <p style="color: #666;">No hay presupuestos registrados</p>
                    </div>
                </div>
            </div>

            <!-- Facturas -->
            <div id="facturas" class="section">
                <h2 style="margin-bottom: 20px; color: #333;">Facturas a Contratistas</h2>

                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #ff4500;">Nueva Factura</h3>
                    <form id="facturaForm">
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label>Obra</label>
                                <select id="facturaObra" required>
                                    <option value="">Seleccionar obra...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Contratista</label>
                                <input type="text" id="facturaContratista" required>
                            </div>
                            <div class="form-group">
                                <label>N√∫mero de Factura</label>
                                <input type="text" id="facturaNumero" required>
                            </div>
                            <div class="form-group">
                                <label>Importe (‚Ç¨)</label>
                                <input type="number" step="0.01" id="facturaImporte" required>
                            </div>
                            <div class="form-group">
                                <label>Fecha de Factura</label>
                                <input type="date" id="facturaFecha" required>
                            </div>
                            <div class="form-group">
                                <label>Estado</label>
                                <select id="facturaEstado" required>
                                    <option value="pendiente">Pendiente</option>
                                    <option value="pagada">Pagada</option>
                                    <option value="vencida">Vencida</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Concepto</label>
                            <textarea id="facturaConcepto" placeholder="Concepto de la factura..."></textarea>
                        </div>
                        <button type="submit" class="btn">Registrar Factura</button>
                    </form>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #ff4500;">Facturas Registradas</h3>
                    <div id="listaFacturas">
                        <p style="color: #666;">No hay facturas registradas</p>
                    </div>
                </div>
            </div>

            <!-- Gastos -->
            <div id="gastos" class="section">
                <h2 style="margin-bottom: 20px; color: #333;">Gastos de Material</h2>

                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #ff4500;">Nuevo Gasto</h3>
                    <form id="gastoForm">
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label>Obra</label>
                                <select id="gastoObra" required>
                                    <option value="">Seleccionar obra...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Proveedor</label>
                                <input type="text" id="gastoProveedor" required>
                            </div>
                            <div class="form-group">
                                <label>Material/Concepto</label>
                                <input type="text" id="gastoConcepto" required>
                            </div>
                            <div class="form-group">
                                <label>Importe (‚Ç¨)</label>
                                <input type="number" step="0.01" id="gastoImporte" required>
                            </div>
                            <div class="form-group">
                                <label>Fecha</label>
                                <input type="date" id="gastoFecha" required>
                            </div>
                            <div class="form-group">
                                <label>Categor√≠a</label>
                                <select id="gastoCategoria" required>
                                    <option value="">Seleccionar categor√≠a...</option>
                                    <option value="cables">Cables</option>
                                    <option value="enchufes">Enchufes e Interruptores</option>
                                    <option value="cuadros">Cuadros El√©ctricos</option>
                                    <option value="iluminacion">Iluminaci√≥n</option>
                                    <option value="herramientas">Herramientas</option>
                                    <option value="otros">Otros</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <textarea id="gastoDescripcion" placeholder="Descripci√≥n del material o gasto..."></textarea>
                        </div>
                        <button type="submit" class="btn">Registrar Gasto</button>
                    </form>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #ff4500;">Gastos Registrados</h3>
                    <div id="listaGastos">
                        <p style="color: #666;">No hay gastos registrados</p>
                    </div>
                </div>
            </div>

            <!-- Fotos -->
            <div id="fotos" class="section">
                <h2 style="margin-bottom: 20px; color: #333;">Galer√≠a de Fotos</h2>

                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #ff4500;">Subir Nueva Foto</h3>
                    <form id="fotoForm">
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label>Obra</label>
                                <select id="fotoObra" required>
                                    <option value="">Seleccionar obra...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Descripci√≥n</label>
                                <input type="text" id="fotoDescripcion" placeholder="Describe la foto..." required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Seleccionar Foto</label>
                            <div class="file-input-wrapper">
                                <input type="file" id="fotoArchivo" accept="image/*" required>
                                <span>Seleccionar Imagen</span>
                            </div>
                        </div>
                        <button type="submit" class="btn">Subir Foto</button>
                    </form>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #ff4500;">Galer√≠a de Fotos</h3>
                    <div id="galeriaFotos" class="gallery">
                        <p style="color: #666;">No hay fotos registradas</p>
                    </div>
                </div>
            </div>

            <!-- Archivos PDF -->
            <div id="archivos" class="section">
                <h2 style="margin-bottom: 20px; color: #333;">Archivos PDF</h2>

                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #ff4500;">Subir Nuevo Archivo</h3>
                    <form id="archivoForm">
                        <div class="grid grid-2">
                            <div class="form-group">
                                <label>Obra</label>
                                <select id="archivoObra" required>
                                    <option value="">Seleccionar obra...</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Tipo de Documento</label>
                                <select id="archivoTipo" required>
                                    <option value="">Seleccionar tipo...</option>
                                    <option value="presupuesto_material">Presupuesto de Material</option>
                                    <option value="catalogo">Cat√°logo de Productos</option>
                                    <option value="factura">Factura</option>
                                    <option value="certificado">Certificado</option>
                                    <option value="planos">Planos</option>
                                    <option value="otros">Otros</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Descripci√≥n</label>
                            <input type="text" id="archivoDescripcion" placeholder="Describe el archivo..." required>
                        </div>
                        <div class="form-group">
                            <label>Seleccionar Archivo PDF</label>
                            <div class="file-input-wrapper">
                                <input type="file" id="archivoArchivo" accept=".pdf" required>
                                <span>Seleccionar PDF</span>
                            </div>
                        </div>
                        <button type="submit" class="btn">Subir Archivo</button>
                    </form>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px; color: #ff4500;">Archivos Registrados</h3>
                    <div id="listaArchivos">
                        <p style="color: #666;">No hay archivos registrados</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para ver im√°genes -->
    <div id="imageModal" class="modal">
        <span class="close">&times;</span>
        <div class="modal-content">
            <img id="modalImage" src="" alt="">
        </div>
    </div>

    <script>
        // Datos persistentes con localStorage
        let data = {
            obras: [],
            presupuestos: [],
            facturas: [],
            gastos: [],
            fotos: [],
            archivos: []
        };

        // Cargar datos del localStorage
        function loadData() {
            try {
                const savedData = localStorage.getItem('llumRequenaData');
                if (savedData) {
                    data = JSON.parse(savedData);
                }
            } catch (error) {
                console.log('Error loading data:', error);
            }
        }

        // Guardar datos en localStorage
        function saveData() {
            try {
                localStorage.setItem('llumRequenaData', JSON.stringify(data));
            } catch (error) {
                console.log('Error saving data:', error);
            }
        }

        // Funci√≥n para mostrar secciones
        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            // Efecto especial en el logo
            document.querySelector('.logo-icon').addEventListener('click', function() {
                this.style.animation = 'electricPulse 0.6s ease-in-out';
                setTimeout(() => {
                    this.style.animation = '';
                }, 600);
            });
            
            // Mostrar la secci√≥n seleccionada
            document.getElementById(sectionId).classList.add('active');
            
            // Actualizar tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
        }

        // Inicializar la aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            checkSystemCompatibility(); // Verificar compatibilidad
            loadData(); // Cargar datos guardados
            initializeForms();
            updateDashboard();
            updateSelectOptions();
            updateObras();
            updatePresupuestos();
            updateFacturas();
            updateGastos();
            updateFotos();
            updateArchivos();
        });

        // Verificar compatibilidad del sistema
        function checkSystemCompatibility() {
            const statusDiv = document.getElementById('systemStatus');
            let status = [];
            let hasIssues = false;
            
            // Verificar localStorage
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                status.push('‚úÖ LocalStorage: Funcional');
            } catch (e) {
                status.push('‚ùå LocalStorage: No disponible - Los datos no se guardar√°n');
                hasIssues = true;
            }
            
            // Verificar File API
            if (window.File && window.FileReader && window.FileList && window.Blob) {
                status.push('‚úÖ File API: Compatible');
                
                // Probar acceso a inputs de archivo
                const fotoInput = document.getElementById('fotoArchivo');
                const archivoInput = document.getElementById('archivoArchivo');
                
                if (fotoInput && archivoInput) {
                    status.push('‚úÖ Inputs de Archivo: Encontrados');
                    
                    // Verificar si pueden abrirse
                    try {
                        const testClick = new Event('click', { bubbles: true });
                        fotoInput.dispatchEvent(testClick);
                        status.push('‚úÖ Eventos de Archivo: Funcionales');
                    } catch (e) {
                        status.push('‚ö†Ô∏è Eventos de Archivo: Problemas detectados');
                        hasIssues = true;
                    }
                } else {
                    status.push('‚ùå Inputs de Archivo: No encontrados');
                    hasIssues = true;
                }
            } else {
                status.push('‚ùå File API: No compatible con este navegador');
                hasIssues = true;
            }
            
            // Verificar protocolo
            if (location.protocol === 'file:') {
                status.push('‚ö†Ô∏è Protocolo: Archivo local (limitaciones de seguridad)');
                status.push('üí° PROBLEMA COM√öN: Chrome bloquea archivos locales');
                hasIssues = true;
            } else {
                status.push('‚úÖ Protocolo: HTTP/HTTPS (√≥ptimo)');
            }
            
            // Verificar navegador y OS espec√≠ficos
            const isChrome = /Chrome/.test(navigator.userAgent);
            const isChromeOS = /CrOS/.test(navigator.userAgent);
            const isFirefox = /Firefox/.test(navigator.userAgent);
            
            if (isChromeOS) {
                status.push('‚ö†Ô∏è Chrome OS detectado: Restricciones de archivos activas');
                status.push('üîß SOLUCI√ìN: Usar servidor local, Firefox o CodePen.io');
                hasIssues = true;
            } else if (isChrome && location.protocol === 'file:') {
                status.push('‚ö†Ô∏è Chrome + Archivo Local: Acceso a archivos bloqueado');
                status.push('üîß SOLUCI√ìN: Usar flags especiales o servidor local');
                hasIssues = true;
            } else if (isFirefox) {
                status.push('‚úÖ Firefox: Excelente compatibilidad para archivos locales');
            }

            // Mostrar soluciones si hay problemas
            if (hasIssues) {
                status.push('');
                status.push('üöÄ SOLUCIONES PARA ARCHIVOS:');
                status.push('1. Usar el bot√≥n "üìÅ Forzar Di√°logo de Archivos"');
                status.push('2. CodePen.io (funciona 100% online)');
                status.push('3. Firefox en lugar de Chrome');
                status.push('4. Servidor local: python3 -m http.server 8000');
                status.push('5. Chrome con flags: --allow-file-access-from-files');
            }
            
            statusDiv.innerHTML = status.join('<br>');
        }

        // Inicializar formularios
        function initializeForms() {
            // Formulario de obras
            document.getElementById('obraForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addObra();
            });

            // Formulario de presupuestos
            document.getElementById('presupuestoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addPresupuesto();
            });

            // Formulario de facturas
            document.getElementById('facturaForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addFactura();
            });

            // Formulario de gastos
            document.getElementById('gastoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addGasto();
            });

            // Formulario de fotos
            document.getElementById('fotoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addFoto();
            });

            // Formulario de archivos
            document.getElementById('archivoForm').addEventListener('submit', function(e) {
                e.preventDefault();
                addArchivo();
            });

            // Modal de im√°genes
            document.querySelector('.close').addEventListener('click', function() {
                document.getElementById('imageModal').style.display = 'none';
            });

            // Mejorar feedback de inputs de archivo y debugging
            const fotoInput = document.getElementById('fotoArchivo');
            const archivoInput = document.getElementById('archivoArchivo');
            
            // Debug: Verificar que los elementos existen
            console.log('Foto input encontrado:', !!fotoInput);
            console.log('Archivo input encontrado:', !!archivoInput);
            
            if (fotoInput) {
                // Evento change para feedback visual
                fotoInput.addEventListener('change', function(e) {
                    console.log('Foto input change event:', e.target.files.length);
                    const wrapper = e.target.parentElement;
                    const span = wrapper.querySelector('span');
                    if (e.target.files.length > 0) {
                        span.textContent = `üì∑ ${e.target.files[0].name}`;
                        wrapper.style.background = 'linear-gradient(45deg, #ffab91, #ff8c42)';
                        console.log('Archivo seleccionado:', e.target.files[0].name);
                    } else {
                        span.textContent = 'Seleccionar Imagen';
                        wrapper.style.background = 'linear-gradient(45deg, #ff6b35, #ff4500)';
                    }
                });

                // Evento click para debug
                fotoInput.addEventListener('click', function(e) {
                    console.log('Foto input clicked');
                });

                // Click en el wrapper para asegurar funcionamiento
                const fotoWrapper = fotoInput.parentElement;
                fotoWrapper.addEventListener('click', function(e) {
                    console.log('Foto wrapper clicked');
                    // Asegurar que el click llegue al input
                    if (e.target !== fotoInput) {
                        fotoInput.click();
                    }
                });
            }

            if (archivoInput) {
                // Evento change para feedback visual
                archivoInput.addEventListener('change', function(e) {
                    console.log('Archivo input change event:', e.target.files.length);
                    const wrapper = e.target.parentElement;
                    const span = wrapper.querySelector('span');
                    if (e.target.files.length > 0) {
                        span.textContent = `üìÑ ${e.target.files[0].name}`;
                        wrapper.style.background = 'linear-gradient(45deg, #ffab91, #ff8c42)';
                        console.log('Archivo seleccionado:', e.target.files[0].name);
                    } else {
                        span.textContent = 'Seleccionar PDF';
                        wrapper.style.background = 'linear-gradient(45deg, #ff6b35, #ff4500)';
                    }
                });

                // Evento click para debug
                archivoInput.addEventListener('click', function(e) {
                    console.log('Archivo input clicked');
                });

                // Click en el wrapper para asegurar funcionamiento
                const archivoWrapper = archivoInput.parentElement;
                archivoWrapper.addEventListener('click', function(e) {
                    console.log('Archivo wrapper clicked');
                    // Asegurar que el click llegue al input
                    if (e.target !== archivoInput) {
                        archivoInput.click();
                    }
                });
            }

            // Efecto especial en el logo
            document.querySelector('.logo-icon').addEventListener('click', function() {
                this.style.animation = 'electricPulse 0.6s ease-in-out';
                setTimeout(() => {
                    this.style.animation = '';
                }, 600);
            });
        }

        // Funciones para agregar datos
        function addObra() {
            const obra = {
                id: Date.now(),
                nombre: document.getElementById('obraNombre').value,
                cliente: document.getElementById('obraCliente').value,
                fechaInicio: document.getElementById('obraFechaInicio').value,
                fechaFin: document.getElementById('obraFechaFin').value,
                descripcion: document.getElementById('obraDescripcion').value
            };
            
            data.obras.push(obra);
            saveData(); // Guardar en localStorage
            document.getElementById('obraForm').reset();
            updateObras();
            updateSelectOptions();
            updateDashboard();
        }

        function addPresupuesto() {
            const presupuesto = {
                id: Date.now(),
                obraId: document.getElementById('presupuestoObra').value,
                concepto: document.getElementById('presupuestoConcepto').value,
                importe: parseFloat(document.getElementById('presupuestoImporte').value),
                fecha: document.getElementById('presupuestoFecha').value,
                descripcion: document.getElementById('presupuestoDescripcion').value
            };
            
            data.presupuestos.push(presupuesto);
            saveData(); // Guardar en localStorage
            document.getElementById('presupuestoForm').reset();
            updatePresupuestos();
            updateDashboard();
        }

        function addFactura() {
            const factura = {
                id: Date.now(),
                obraId: document.getElementById('facturaObra').value,
                contratista: document.getElementById('facturaContratista').value,
                numero: document.getElementById('facturaNumero').value,
                importe: parseFloat(document.getElementById('facturaImporte').value),
                fecha: document.getElementById('facturaFecha').value,
                estado: document.getElementById('facturaEstado').value,
                concepto: document.getElementById('facturaConcepto').value
            };
            
            data.facturas.push(factura);
            saveData(); // Guardar en localStorage
            document.getElementById('facturaForm').reset();
            updateFacturas();
            updateDashboard();
        }

        function addGasto() {
            const gasto = {
                id: Date.now(),
                obraId: document.getElementById('gastoObra').value,
                proveedor: document.getElementById('gastoProveedor').value,
                concepto: document.getElementById('gastoConcepto').value,
                importe: parseFloat(document.getElementById('gastoImporte').value),
                fecha: document.getElementById('gastoFecha').value,
                categoria: document.getElementById('gastoCategoria').value,
                descripcion: document.getElementById('gastoDescripcion').value
            };
            
            data.gastos.push(gasto);
            saveData(); // Guardar en localStorage
            document.getElementById('gastoForm').reset();
            updateGastos();
            updateDashboard();
        }

        function addFoto() {
            console.log('addFoto() llamada');
            const fileInput = document.getElementById('fotoArchivo');
            const file = fileInput.files[0];
            
            console.log('Files encontrados:', fileInput.files.length);
            
            if (!file) {
                // Mostrar ayuda espec√≠fica si no puede seleccionar archivos
                console.log('No hay archivo seleccionado');
                
                if (location.protocol === 'file:' && /CrOS/.test(navigator.userAgent)) {
                    showChromeOSFileHelp();
                    return;
                }
                
                // Si no hay archivo, intentar abrir el selector
                try {
                    console.log('Intentando abrir selector de archivos...');
                    fileInput.click();
                    return;
                } catch (error) {
                    console.error('Error al abrir selector:', error);
                    alert('‚ùå No se puede abrir el selector de archivos.\n\nüîß Soluciones:\n1. Verifica permisos del navegador\n2. Usa Firefox en lugar de Chrome\n3. Prueba con CodePen.io\n4. Usa el bot√≥n "üìÅ Forzar Di√°logo de Archivos"');
                    return;
                }
            }

            console.log('Archivo seleccionado:', file.name, 'Tama√±o:', file.size);

            // Verificar tama√±o del archivo (m√°ximo 5MB)
            if (file.size > 5 * 1024 * 1024) {
                alert('La imagen es demasiado grande. M√°ximo 5MB permitido.');
                return;
            }

            // Verificar tipo de archivo
            if (!file.type.startsWith('image/')) {
                alert('Por favor selecciona un archivo de imagen v√°lido');
                return;
            }

            const reader = new FileReader();
            
            reader.onerror = function() {
                console.error('Error al leer el archivo');
                alert('Error al leer el archivo. Int√©ntalo de nuevo.');
            };
            
            reader.onload = function(e) {
                try {
                    console.log('Archivo le√≠do correctamente, guardando...');
                    const foto = {
                        id: Date.now(),
                        obraId: document.getElementById('fotoObra').value,
                        descripcion: document.getElementById('fotoDescripcion').value,
                        archivo: e.target.result,
                        fecha: new Date().toISOString().split('T')[0],
                        nombre: file.name,
                        tama√±o: file.size
                    };
                    
                    data.fotos.push(foto);
                    saveData(); // Guardar en localStorage
                    document.getElementById('fotoForm').reset();
                    updateFotos();
                    alert('‚úÖ Foto subida correctamente');
                    console.log('Foto guardada exitosamente');
                } catch (error) {
                    console.error('Error al guardar:', error);
                    alert('Error al guardar la foto: ' + error.message);
                }
            };
            
            reader.readAsDataURL(file);
        }

        function showChromeOSFileHelp() {
            const help = `
‚ùå Chrome OS no permite subir archivos desde archivos locales

üöÄ SOLUCIONES R√ÅPIDAS:

1Ô∏è‚É£ CODEPEN (Recomendado):
‚Ä¢ Ve a codepen.io
‚Ä¢ Crea nuevo pen
‚Ä¢ Pega el c√≥digo HTML
‚Ä¢ ¬°Funciona perfectamente!

2Ô∏è‚É£ SERVIDOR LOCAL:
‚Ä¢ Usa el bot√≥n "üõ†Ô∏è Soluciones Chrome OS"
‚Ä¢ Sigue las instrucciones del terminal Linux

3Ô∏è‚É£ COPIAR C√ìDIGO:
‚Ä¢ Usa "üìã Copiar C√≥digo Completo"
‚Ä¢ P√©galo en tu editor favorito online

¬øQuieres que abra CodePen autom√°ticamente?`;

            if (confirm(help + '\n\n¬øAbrir CodePen.io ahora?')) {
                window.open('https://codepen.io/pen/', '_blank');
            }
        }

        function addArchivo() {
            console.log('addArchivo() llamada');
            const fileInput = document.getElementById('archivoArchivo');
            const file = fileInput.files[0];
            
            console.log('Files encontrados:', fileInput.files.length);
            
            if (!file) {
                // Mostrar ayuda espec√≠fica si no puede seleccionar archivos
                console.log('No hay archivo seleccionado');
                
                if (location.protocol === 'file:' && /CrOS/.test(navigator.userAgent)) {
                    showChromeOSFileHelp();
                    return;
                }
                
                // Si no hay archivo, intentar abrir el selector
                try {
                    console.log('Intentando abrir selector de PDFs...');
                    fileInput.click();
                    return;
                } catch (error) {
                    console.error('Error al abrir selector:', error);
                    alert('‚ùå No se puede abrir el selector de archivos.\n\nüîß Soluciones:\n1. Verifica permisos del navegador\n2. Usa Firefox en lugar de Chrome\n3. Prueba con CodePen.io\n4. Usa el bot√≥n "üìÅ Forzar Di√°logo de Archivos"');
                    return;
                }
            }

            console.log('Archivo seleccionado:', file.name, 'Tipo:', file.type, 'Tama√±o:', file.size);

            // Verificar que sea PDF
            if (file.type !== 'application/pdf') {
                alert('Por favor selecciona solo archivos PDF');
                return;
            }

            // Verificar tama√±o del archivo (m√°ximo 10MB)
            if (file.size > 10 * 1024 * 1024) {
                alert('El archivo PDF es demasiado grande. M√°ximo 10MB permitido.');
                return;
            }

            try {
                console.log('Guardando archivo PDF...');
                const archivo = {
                    id: Date.now(),
                    obraId: document.getElementById('archivoObra').value,
                    tipo: document.getElementById('archivoTipo').value,
                    descripcion: document.getElementById('archivoDescripcion').value,
                    nombre: file.name,
                    tama√±o: file.size,
                    fecha: new Date().toISOString().split('T')[0]
                };
                
                data.archivos.push(archivo);
                saveData(); // Guardar en localStorage
                document.getElementById('archivoForm').reset();
                updateArchivos();
                alert('‚úÖ Archivo PDF registrado correctamente');
                console.log('Archivo guardado exitosamente');
            } catch (error) {
                console.error('Error al guardar:', error);
                alert('Error al guardar el archivo: ' + error.message);
            }
        }

        // Funciones para actualizar las listas
        function updateObras() {
            const container = document.getElementById('listaObras');
            if (data.obras.length === 0) {
                container.innerHTML = '<p style="color: #666;">No hay obras registradas</p>';
                return;
            }
            
            container.innerHTML = data.obras.map(obra => `
                <div class="obra-item">
                    <div class="item-header">
                        <div class="item-title">${obra.nombre}</div>
                        <button class="btn btn-danger" onclick="deleteItem('obras', ${obra.id})">Eliminar</button>
                    </div>
                    <p><strong>Cliente:</strong> ${obra.cliente}</p>
                    <p><strong>Inicio:</strong> ${formatDate(obra.fechaInicio)}</p>
                    ${obra.fechaFin ? `<p><strong>Fin estimado:</strong> ${formatDate(obra.fechaFin)}</p>` : ''}
                    ${obra.descripcion ? `<p><strong>Descripci√≥n:</strong> ${obra.descripcion}</p>` : ''}
                </div>
            `).join('');
        }

        function updatePresupuestos() {
            const container = document.getElementById('listaPresupuestos');
            if (data.presupuestos.length === 0) {
                container.innerHTML = '<p style="color: #666;">No hay presupuestos registrados</p>';
                return;
            }
            
            container.innerHTML = data.presupuestos.map(presupuesto => {
                const obra = data.obras.find(o => o.id == presupuesto.obraId);
                return `
                    <div class="presupuesto-item">
                        <div class="item-header">
                            <div class="item-title">${presupuesto.concepto}</div>
                            <div class="item-amount">${formatCurrency(presupuesto.importe)}</div>
                        </div>
                        <p><strong>Obra:</strong> ${obra ? obra.nombre : 'N/A'}</p>
                        <p><strong>Fecha:</strong> ${formatDate(presupuesto.fecha)}</p>
                        ${presupuesto.descripcion ? `<p><strong>Descripci√≥n:</strong> ${presupuesto.descripcion}</p>` : ''}
                        <button class="btn btn-danger" onclick="deleteItem('presupuestos', ${presupuesto.id})">Eliminar</button>
                    </div>
                `;
            }).join('');
        }

        function updateFacturas() {
            const container = document.getElementById('listaFacturas');
            if (data.facturas.length === 0) {
                container.innerHTML = '<p style="color: #666;">No hay facturas registradas</p>';
                return;
            }
            
            container.innerHTML = data.facturas.map(factura => {
                const obra = data.obras.find(o => o.id == factura.obraId);
                const estadoColor = factura.estado === 'pagada' ? '#28a745' : factura.estado === 'vencida' ? '#dc3545' : '#ffc107';
                return `
                    <div class="factura-item">
                        <div class="item-header">
                            <div class="item-title">Factura ${factura.numero}</div>
                            <div class="item-amount">${formatCurrency(factura.importe)}</div>
                        </div>
                        <p><strong>Obra:</strong> ${obra ? obra.nombre : 'N/A'}</p>
                        <p><strong>Contratista:</strong> ${factura.contratista}</p>
                        <p><strong>Fecha:</strong> ${formatDate(factura.fecha)}</p>
                        <p><strong>Estado:</strong> <span style="color: ${estadoColor}; font-weight: bold;">${factura.estado.toUpperCase()}</span></p>
                        ${factura.concepto ? `<p><strong>Concepto:</strong> ${factura.concepto}</p>` : ''}
                        <button class="btn btn-danger" onclick="deleteItem('facturas', ${factura.id})">Eliminar</button>
                    </div>
                `;
            }).join('');
        }

        function updateGastos() {
            const container = document.getElementById('listaGastos');
            if (data.gastos.length === 0) {
                container.innerHTML = '<p style="color: #666;">No hay gastos registrados</p>';
                return;
            }
            
            container.innerHTML = data.gastos.map(gasto => {
                const obra = data.obras.find(o => o.id == gasto.obraId);
                return `
                    <div class="gasto-item">
                        <div class="item-header">
                            <div class="item-title">${gasto.concepto}</div>
                            <div class="item-amount">${formatCurrency(gasto.importe)}</div>
                        </div>
                        <p><strong>Obra:</strong> ${obra ? obra.nombre : 'N/A'}</p>
                        <p><strong>Proveedor:</strong> ${gasto.proveedor}</p>
                        <p><strong>Categor√≠a:</strong> ${gasto.categoria}</p>
                        <p><strong>Fecha:</strong> ${formatDate(gasto.fecha)}</p>
                        ${gasto.descripcion ? `<p><strong>Descripci√≥n:</strong> ${gasto.descripcion}</p>` : ''}
                        <button class="btn btn-danger" onclick="deleteItem('gastos', ${gasto.id})">Eliminar</button>
                    </div>
                `;
            }).join('');
        }

        function updateFotos() {
            const container = document.getElementById('galeriaFotos');
            if (data.fotos.length === 0) {
                container.innerHTML = '<p style="color: #666;">No hay fotos registradas</p>';
                return;
            }
            
            container.innerHTML = data.fotos.map(foto => {
                const obra = data.obras.find(o => o.id == foto.obraId);
                return `
                    <div class="foto-item">
                        <img src="${foto.archivo}" alt="${foto.descripcion}" class="photo-preview" onclick="showImage('${foto.archivo}')">
                        <p style="margin-top: 10px; font-weight: 500;">${foto.descripcion}</p>
                        <p style="font-size: 0.9em; color: #666;">${obra ? obra.nombre : 'N/A'}</p>
                        <p style="font-size: 0.8em; color: #999;">${formatDate(foto.fecha)}</p>
                        <button class="btn btn-danger" style="margin-top: 10px;" onclick="deleteItem('fotos', ${foto.id})">Eliminar</button>
                    </div>
                `;
            }).join('');
        }

        function updateArchivos() {
            const container = document.getElementById('listaArchivos');
            if (data.archivos.length === 0) {
                container.innerHTML = '<p style="color: #666;">No hay archivos registrados</p>';
                return;
            }
            
            container.innerHTML = data.archivos.map(archivo => {
                const obra = data.obras.find(o => o.id == archivo.obraId);
                return `
                    <div class="pdf-item">
                        <div class="item-header">
                            <div class="item-title">üìÑ ${archivo.nombre}</div>
                            <button class="btn btn-danger" onclick="deleteItem('archivos', ${archivo.id})">Eliminar</button>
                        </div>
                        <p><strong>Obra:</strong> ${obra ? obra.nombre : 'N/A'}</p>
                        <p><strong>Tipo:</strong> ${archivo.tipo}</p>
                        <p><strong>Descripci√≥n:</strong> ${archivo.descripcion}</p>
                        <p><strong>Fecha:</strong> ${formatDate(archivo.fecha)}</p>
                    </div>
                `;
            }).join('');
        }

        // Actualizar opciones de select
        function updateSelectOptions() {
            const selects = ['presupuestoObra', 'facturaObra', 'gastoObra', 'fotoObra', 'archivoObra'];
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                const currentValue = select.value;
                select.innerHTML = '<option value="">Seleccionar obra...</option>';
                data.obras.forEach(obra => {
                    const option = document.createElement('option');
                    option.value = obra.id;
                    option.textContent = obra.nombre;
                    if (obra.id == currentValue) option.selected = true;
                    select.appendChild(option);
                });
            });
        }

        // Actualizar dashboard
        function updateDashboard() {
            document.getElementById('totalObras').textContent = data.obras.length;
            
            const totalPresupuesto = data.presupuestos.reduce((sum, p) => sum + p.importe, 0);
            document.getElementById('totalPresupuesto').textContent = formatCurrency(totalPresupuesto);
            
            const totalFacturado = data.facturas.reduce((sum, f) => sum + f.importe, 0);
            document.getElementById('totalFacturado').textContent = formatCurrency(totalFacturado);
            
            const totalGastos = data.gastos.reduce((sum, g) => sum + g.importe, 0);
            document.getElementById('totalGastos').textContent = formatCurrency(totalGastos);
            
            // Actualizar obras recientes
            const obrasRecientes = data.obras.slice(-3).reverse();
            const container = document.getElementById('obrasRecientes');
            if (obrasRecientes.length === 0) {
                container.innerHTML = '<p style="color: #666;">No hay obras registradas</p>';
            } else {
                container.innerHTML = obrasRecientes.map(obra => `
                    <div style="padding: 10px; border-left: 3px solid #ff6b35; margin-bottom: 10px;">
                        <strong>${obra.nombre}</strong> - ${obra.cliente}
                        <br><small>Inicio: ${formatDate(obra.fechaInicio)}</small>
                    </div>
                `).join('');
            }
        }

        // Funci√≥n para eliminar elementos
        function deleteItem(type, id) {
            if (confirm('¬øEst√°s seguro de que quieres eliminar este elemento?')) {
                data[type] = data[type].filter(item => item.id !== id);
                saveData(); // Guardar cambios en localStorage
                
                switch(type) {
                    case 'obras':
                        updateObras();
                        updateSelectOptions();
                        break;
                    case 'presupuestos':
                        updatePresupuestos();
                        break;
                    case 'facturas':
                        updateFacturas();
                        break;
                    case 'gastos':
                        updateGastos();
                        break;
                    case 'fotos':
                        updateFotos();
                        break;
                    case 'archivos':
                        updateArchivos();
                        break;
                }
                updateDashboard();
            }
        }

        // Funci√≥n para mostrar imagen en modal
        function showImage(src) {
            document.getElementById('modalImage').src = src;
            document.getElementById('imageModal').style.display = 'block';
        }

        // Funciones de utilidad
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-ES');
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('es-ES', {
                style: 'currency',
                currency: 'EUR'
            }).format(amount);
        }

        // Funciones de gesti√≥n de datos
        function exportData() {
            try {
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `llum-requena-backup-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                alert('Datos exportados correctamente');
            } catch (error) {
                alert('Error al exportar datos: ' + error.message);
            }
        }

        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedData = JSON.parse(e.target.result);
                        if (confirm('¬øEst√°s seguro de que quieres importar estos datos? Esto sobrescribir√° todos los datos actuales.')) {
                            data = importedData;
                            saveData();
                            
                            // Actualizar todas las vistas
                            updateDashboard();
                            updateSelectOptions();
                            updateObras();
                            updatePresupuestos();
                            updateFacturas();
                            updateGastos();
                            updateFotos();
                            updateArchivos();
                            
                            alert('Datos importados correctamente');
                        }
                    } catch (error) {
                        alert('Error al importar datos: Archivo no v√°lido');
                    }
                };
                reader.readAsText(file);
            }
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è ADVERTENCIA: Esto eliminar√° TODOS los datos de forma permanente. ¬øEst√°s completamente seguro?')) {
                if (confirm('Esta acci√≥n NO se puede deshacer. ¬øConfirmas que quieres eliminar todos los datos?')) {
                    data = {
                        obras: [],
                        presupuestos: [],
                        facturas: [],
                        gastos: [],
                        fotos: [],
                        archivos: []
                    };
                    saveData();
                    
                    // Actualizar todas las vistas
                    updateDashboard();
                    updateSelectOptions();
                    updateObras();
                    updatePresupuestos();
                    updateFacturas();
                    updateGastos();
                    updateFotos();
                    updateArchivos();
                    
                    alert('Todos los datos han sido eliminados');
                }
            }
        }

        // Funciones de diagn√≥stico
        function testFileUpload() {
            document.getElementById('testFile').click();
        }

        function forceFileDialog() {
            console.log('Forzando di√°logo de archivos...');
            
            // Probar con foto input primero
            const fotoInput = document.getElementById('fotoArchivo');
            const archivoInput = document.getElementById('archivoArchivo');
            
            if (fotoInput) {
                console.log('Intentando abrir selector de fotos...');
                try {
                    fotoInput.click();
                    setTimeout(() => {
                        if (fotoInput.files.length === 0) {
                            console.log('No se seleccion√≥ archivo de foto');
                            // Probar con PDF
                            if (archivoInput) {
                                console.log('Intentando abrir selector de PDFs...');
                                archivoInput.click();
                                setTimeout(() => {
                                    if (archivoInput.files.length === 0) {
                                        showFileDialogHelp();
                                    }
                                }, 1000);
                            }
                        } else {
                            alert('‚úÖ ¬°Selector de archivos funcionando! Se seleccion√≥: ' + fotoInput.files[0].name);
                        }
                    }, 1000);
                } catch (error) {
                    console.error('Error al abrir selector:', error);
                    showFileDialogHelp();
                }
            } else {
                alert('‚ùå Error: No se encontraron los inputs de archivo');
            }
        }

        function showFileDialogHelp() {
            const help = `
‚ùå PROBLEMA DETECTADO: Los selectores de archivo no funcionan

üîß POSIBLES CAUSAS:
‚Ä¢ Permisos del navegador bloqueados
‚Ä¢ Chrome OS restringiendo acceso a archivos
‚Ä¢ Archivo ejecut√°ndose localmente sin permisos

üì± SOLUCIONES INMEDIATAS:

1Ô∏è‚É£ VERIFICA PERMISOS:
‚Ä¢ chrome://settings/content/fileSystemWrite
‚Ä¢ Permitir acceso a archivos

2Ô∏è‚É£ PRUEBA EN FIREFOX:
‚Ä¢ Descarga Firefox
‚Ä¢ Abre tu archivo HTML all√≠
‚Ä¢ Deber√≠a funcionar mejor

3Ô∏è‚É£ USA CODEPEN (Recomendado):
‚Ä¢ Copia el c√≥digo con el bot√≥n
‚Ä¢ Ve a codepen.io
‚Ä¢ Funciona perfectamente online

4Ô∏è‚É£ SERVIDOR LOCAL:
‚Ä¢ Terminal: python3 -m http.server 8000
‚Ä¢ Abre: localhost:8000/tu-archivo.html

¬øQuieres que abra CodePen autom√°ticamente?`;

            if (confirm(help + '\n\n¬øAbrir CodePen.io ahora?')) {
                window.open('https://codepen.io/pen/', '_blank');
            }
        }

        function handleTestFile(event) {
            const file = event.target.files[0];
            if (file) {
                alert(`‚úÖ ¬°Archivo seleccionado correctamente!\n\nNombre: ${file.name}\nTama√±o: ${(file.size / 1024).toFixed(2)} KB\nTipo: ${file.type}\n\nLa subida de archivos funciona en tu navegador.`);
                event.target.value = ''; // Limpiar selecci√≥n
            } else {
                // Si est√° en Chrome OS y archivo local, mostrar ayuda
                if (location.protocol === 'file:' && /CrOS/.test(navigator.userAgent)) {
                    alert('‚ùå Chrome OS no permite seleccionar archivos desde archivos locales.\n\nüöÄ Usa el bot√≥n "üõ†Ô∏è Soluciones Chrome OS" para ver las alternativas.\n\n‚úÖ Recomendado: CodePen.io o servidor local');
                } else {
                    alert('‚ùå No se pudo seleccionar el archivo. Verifica los permisos del navegador.');
                }
            }
        }

        function testLocalStorage() {
            try {
                const testData = { test: 'Prueba de almacenamiento', timestamp: new Date().toISOString() };
                localStorage.setItem('llumRequenaTest', JSON.stringify(testData));
                const retrieved = localStorage.getItem('llumRequenaTest');
                
                if (retrieved) {
                    const parsed = JSON.parse(retrieved);
                    alert(`‚úÖ ¬°LocalStorage funciona correctamente!\n\nDatos guardados: ${parsed.test}\nFecha: ${parsed.timestamp}`);
                    localStorage.removeItem('llumRequenaTest');
                } else {
                    alert('‚ùå Error: No se pudieron recuperar los datos guardados');
                }
            } catch (error) {
                alert(`‚ùå Error en LocalStorage: ${error.message}\n\nPosibles soluciones:\n1. Usa Firefox en lugar de Chrome\n2. Abre Chrome con permisos especiales\n3. Usa un servidor local`);
            }
        }

        function showChromeOSSolutions() {
            const solutions = `
üõ†Ô∏è SOLUCIONES ESPEC√çFICAS PARA CHROME OS:

üìã M√âTODO 1 - EDITOR ONLINE (M√°s F√°cil):
‚Ä¢ Ve a CodePen.io o JSFiddle.net
‚Ä¢ Crea un nuevo proyecto
‚Ä¢ Pega el c√≥digo HTML completo
‚Ä¢ Funciona perfectamente online

üåê M√âTODO 2 - EXTENSI√ìN DE CHROME:
‚Ä¢ Instala "Web Server for Chrome"
‚Ä¢ Selecciona carpeta con tu archivo
‚Ä¢ Activa servidor local
‚Ä¢ Abre la URL proporcionada

üíª M√âTODO 3 - TERMINAL LINUX:
‚Ä¢ Activa entorno Linux en Chrome OS
‚Ä¢ Abre Terminal
‚Ä¢ cd /ruta/a/tu/archivo
‚Ä¢ python3 -m http.server 8000
‚Ä¢ Abre: localhost:8000/llum-requena.html

‚öôÔ∏è M√âTODO 4 - FLAGS DE CHROME:
‚Ä¢ Ve a: chrome://flags/
‚Ä¢ Activa: "File System Access API"
‚Ä¢ Activa: "Local file access"
‚Ä¢ Reinicia Chrome

üîß M√âTODO 5 - ACCESO DIRECTO:
‚Ä¢ Crea acceso directo a Chrome
‚Ä¢ A√±ade: --allow-file-access-from-files
‚Ä¢ Usa ese acceso directo para abrir archivos

¬øQuieres que te copie el c√≥digo completo para usar en cualquiera de estos m√©todos?`;

            alert(solutions);
        }

        function copyCodeToClipboard() {
            // Obtener todo el HTML de la p√°gina
            const htmlContent = document.documentElement.outerHTML;
            
            // Intentar copiar al portapapeles
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(htmlContent).then(() => {
                    alert('‚úÖ ¬°C√≥digo copiado al portapapeles!\n\nYa puedes pegarlo en:\n‚Ä¢ CodePen.io\n‚Ä¢ JSFiddle.net\n‚Ä¢ Tu editor favorito\n‚Ä¢ Un nuevo archivo .html');
                }).catch(err => {
                    fallbackCopyMethod(htmlContent);
                });
            } else {
                fallbackCopyMethod(htmlContent);
            }
        }

        function fallbackCopyMethod(content) {
            // M√©todo alternativo para copiar
            const textArea = document.createElement('textarea');
            textArea.value = content;
            textArea.style.position = 'fixed';
            textArea.style.left = '-9999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                alert('‚úÖ ¬°C√≥digo copiado al portapapeles!\n\nYa puedes pegarlo en:\n‚Ä¢ CodePen.io\n‚Ä¢ JSFiddle.net\n‚Ä¢ Tu editor favorito\n‚Ä¢ Un nuevo archivo .html');
            } catch (err) {
                alert('‚ùå No se pudo copiar autom√°ticamente.\n\nüí° Soluci√≥n:\n1. Selecciona todo el texto de la p√°gina (Ctrl+A)\n2. Copia (Ctrl+C)\n3. Pega en tu editor o plataforma online');
            }
            
            document.body.removeChild(textArea);
        }

        // Establecer fecha de hoy por defecto
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            const dateInputs = ['presupuestoFecha', 'facturaFecha', 'gastoFecha'];
            dateInputs.forEach(inputId => {
                document.getElementById(inputId).value = today;
            });
        });
    </script>
</body>
</html>
